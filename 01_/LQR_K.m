clc; clear; close all;

%% 1. 定义物理参数 (必须和你 Simulink 代码里的一模一样！)
M = 0.5;  
m = 0.2;  
l = 0.5;  
g = 9.8;
I = 0.005; 
Denom = (M+m)*(I+m*l^2) - (m*l)^2;

%% 2. 构建线性化模型 (A, B 矩阵)
% 这是你在 4.1 节里推导出来的线性化公式
% 状态向量 x = [x; x_dot; theta; theta_dot]

A = [0, 1, 0, 0;
     0, 0, (m^2*g*l^2)/Denom, 0;
     0, 0, 0, 1;
     0, 0, ((M+m)*m*g*l)/Denom, 0];

B = [0;
     (I+m*l^2)/Denom;
     0;
     -(m*l)/Denom];

% C 和 D 矩阵 (全状态反馈假设我们可以看到所有状态)
C = eye(4);
D = zeros(4,1);

%% 3. 设计 LQR 控制器
% Q矩阵: 惩罚状态误差 [x, x_dot, theta, theta_dot]
% 这里的数值决定了你的控制风格
% 试着改改 Q(3,3) (角度惩罚)，把它从 10 改成 100，看看效果
Q = diag([1000, 10, 100, 1]); 

% R矩阵: 惩罚控制力 u
% R 越大，越省电，动作越慢
R = 0.1;

% 计算最优增益 K
K = lqr(A, B, Q, R);

% 打印 K 给你看
disp('计算出的 LQR 增益 K 为：');
disp(K);